def get_tag_data_from_sql(tag, start_date, end_date, interval):
    # 根據 interval 選擇不同的資料表
    if interval == "d":
        tables = ["PI_REPLICATION.dbo.Summary_Daily_AVG_TC_PEM_Melting_1",
                  "PI_REPLICATION.dbo.Summary_Daily_AVG_TC_PEM_Melting_2"]
    elif interval == "h":
        tables = ["PI_REPLICATION.dbo.Summary_Hour_AVG_TC_PEM_Melting_1",
                  "PI_REPLICATION.dbo.Summary_Hour_AVG_TC_PEM_Melting_2"]
    else:
        raise ValueError("Unsupported interval for SQL data retrieval")

    # 從多個表格獲取數據並合併
    all_data = []
    for table_name in tables:
        query = f"""
            SELECT Data_Time, [{tag}] AS Value
            FROM {table_name}
            WHERE Data_Time BETWEEN '{start_date}' AND '{end_date}'
            ORDER BY Data_Time
        """
        data = get_server(query, 'TCF11SQL2011', 'PI_REPLICATION')
        all_data.append(data)

    # 合併所有表格的數據
    df = pd.concat(all_data)

    # 轉換 Data_Time 格式並設置為索引
    df['Data_Time'] = pd.to_datetime(df['Data_Time'])
    df.set_index('Data_Time', inplace=True)

    # 根據 interval (日、時或分) 重新取樣數據
    interval_mapping = {
        "d": "1D",  # 天
        "h": "1H",  # 小時
        "m": "1T"   # 分鐘
    }
    if interval in interval_mapping:
        resampled_data = df.resample(interval_mapping[interval]).mean()
    else:
        resampled_data = df

    return resampled_data
