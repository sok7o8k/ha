import PIconnect as PI
from datetime import datetime, timedelta

# 連接到 PI Server
with PI.PIServer() as server:
    pi_point = server.tag("YourPITag")  # 替換成您的 PI Tag 名稱

    # 設定時間範圍
    start_time = datetime.now() - timedelta(days=1)  # 1 天前
    end_time = datetime.now()  # 現在

    # 使用 summary 方法計算時間加權平均
    twa_summary = pi_point.summary(
        start_time=start_time,
        end_time=end_time,
        calculation="average",
        weighting="time-weighted"  # 指定加權方式
    )

    # 取得時間加權平均值
    time_weighted_avg = twa_summary.value
    print("Time-Weighted Average:", time_weighted_avg)
